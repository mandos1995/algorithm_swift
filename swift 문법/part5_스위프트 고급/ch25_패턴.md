# 25. 패턴

스위프트에는 문법에 응용할 수 있는 다양한 종류의 **패턴** 이 잇다. 여러 패턴을 잘 숙지해두면 스위프트 코드의 양을 줄이는 효과는 물론, 스위프트 문법을 좀 더 잘 활용할 수 있다.

패턴은 '단독 또는 복합 값의 구조를 나타내는 것'이고, 패턴 매칭은 '코드에서 어떤 패턴의 형태를 찾아내는 행위'라고 할 수 있다. 뜻만 놓고 보면 크게 와닿지 않을 것이다. 쉽게 말하지면 '이러이러한 것을 표현하고 싶다'면 '이러이러한 패턴을 통해 표현하면 된다'라고 이해하면 된다. 대부분의 패턴은 switch, if, guard, for 등의 키워드와 아주 친하며 두 개 이상의 키워드가 합을 이뤄 동작한다. 예제에서 볼 수 있겠지만, 대부분의 패턴은 switch 구문에서 강력한 힘을 발휘한다.

스위프트의 패턴은 크게 두 종류로 나뉜다.

* 값을 해체(추출)하거나 무시하는 패턴
  1. 와일드 카드 패턴
  2. 식별자 패턴
  3. 값 바인딩 패턴
  4. 튜플 패턴

* 패턴 매칭을 위한 패턴
  1. 열거형 케이스 패턴
  2. 옵셔널 패턴
  3. 표현 패턴
  4. 타입캐스팅 패턴

이제 스위프트의 다양한 패턴과 이를 실제로 어떻게 사용하는지에 대해 알아보겠다.

## 25.1 와일드카드 패턴

와일드카드 식별자(_)를 사용한다는 것은 '이 자리에 올 것이 무엇이든간에 상관하지 마라'는 뜻이다. 즉, 와일드카드 식별자가 위치한 곳의 값은 무시한다. switch 구문에 사용될 수도 있고, for-in 구문에서도 사용할 수 있다.

```swift
let string: String = "ABC"

switch string {
// ABC -> 어떤 값이 와도 상관업기에 항상 실행된다.
case _: print(string)
}

let optionalString: String? = "ABC"

switch optionalString {
// optionalString이 Optional("ABC")일 때만 실행된다.
case "ABC"?: print(optionalString)

// optionalString이 Optional("ABC") 외의 값이 있을 때만 실행된다.
case _?: print("Has value, but not ABC")

// 값이 없을 때 실행된다.
case nil: print("nil")
}   // Optional("ABC")

let minseok = ("minseok", 99, "Male")

switch minseok {
// 첫 번째 요소가 "minseok"일 때만 실행된다.
case("minseok", _, _): print("Hello minseok!!")

// 그 외 언제든지 실행된다.
case(_, _, _): print("Who cares~")
}   // Hello minseok!!

for _ in 0..<2 {
    print("Hello")
}
// Hello
// Hello
```

## 25.2 식별자 패턴

식별자 패턴은 변수 또는 상수의 이름에 알맞는 값을 어떤 값과 매치시키는 패턴을 말한다.

`let someValue: Int = 42`

위의 코드에서는 let someValue: Int = 42 와 같이 someValue 상수를 선언하는 동시에 someValue에 42라는 값을 할당하려고 한다. 이때 someValue의 타입인 Int와 할당하는 42의 타입이 매치된다면 someValue는 42라는 값의 식별자가 되므로 식별자 패턴이 성립된다. 이렇게 식별자 패턴이 성립되면 42라는 값은 someValue 상수에 할당된다.

사실 너무나 당연히 써왔던 모습이기 때문에 패턴이라고 하기에도 민망할 수 있다. 경우에 따라서 식별자 패턴은 값 바인딩 패턴의 일종이라고 할 수도 있다.

## 25.3 값 바인딩 패턴

값 바인딩 패턴은 변수 또는 상수의 이름에 매치된 값을 바인딩하는 것이다. 값 바인딩 패턴의 일종인 식별자 패턴은 매칭되는 값을 새로운 이름의 변수 또는 상수에 바인딩한다. 에를 들어 튜플의 요소를 해체하여 그에 대응하는 식별자 패턴에 각각의 요소 값을 바인딩하는 것이다.

다음 코드와 같이 switch 구문에서 많이 사용된다.

```swift
let minseok = ("minseok", 99, "Male")

switch minseok {
// name, age, gender를 minseok의 각각의 요소로 바인딩 한다.
case let (name, age, gender) : print("Name: \(name), Age: \(age), Gender: \(gender)")
} // Name: minseok, Age: 99, Gender: Male

switch minseok {
case (let name, let age, let gender) : print("Name: \(name), Age: \(age), Gender: \(gender)")
} // Name: minseok, Age: 99, Gender: Male

switch minseok {
// 값 바인딩 패턴은 와일드카드 패턴과 결합하여 유용하게 사용될 수도 있다.
case (let name, _, let gender): print("Name: \(name), Gender: \(gender)")
} // Name: minseok, Gender: Male
```

## 25.4 튜플 패턴

튜플 패턴은 소괄호 내에 쉼표로 분리하는 리스트이다. 튜플 패턴은 그에 상응하는 튜플 타입과 값을 매치한다. 예를 들어 let (x, y): (Int, Int) = (1, 2)와 같이 상수를 선언한다면 (x, y): (Int, Int)라고 사용된 튜플 패턴은 요소가 모두 Int 타입인 튜플하고만 매치된다는 뜻이다.

튜플 패턴을 for-in 구문 또는 변수나 상수 선언에서 사용한다면 와일드카드 패턴, 식별자 패턴, 옵셔널 패턴, 또 다른 튜플 패턴 등을 함께 사용할 수 있다.

```swift
let (a): Int = 2
print(a)        // 2

let (x, y): (Int, Int) = (1, 2)
print(x)        // 1
print(y)        // 2

let name: String = "Jung"
let age: Int = 99
let gender: String? = "Male"

switch (name, age, gender) {
case ("Jung", _, _): print("Hello Jung!!")
case(_, _, "Male"?): print("Who are you man?")
default: print("I don't know who you are")
}   // Hello Jung!!

let points: [(Int, Int)] = [(0, 0), (1, 0), (1, 1), (2, 0), (2, 1)]

for (x, _) in points {
    print(x)
}
// 0
// 1
// 1
// 2
// 2
```

## 25.5 열거형 케이스 패턴

열거형 케이스 패턴은 값을 열거형 타입의 case와 매치시킨다. 열거형 케이스 패턴은 switch 구문의 case 레이블과 if, while, guard, for-in 구문의 case 조건에서 볼 수 있다. 만약 연관 값이 있는 열거형 케이스와 매치하려고 한다면 열거형 케이스 패턴에서는 반드시 튜플 패턴이 함께해야 한다.

```swift
let someValue: Int = 30

if case 0...100 = someValue {
    print("0 <= \(someValue) <= 100")
}   // 0 <= 30 <= 100

let anotherValue: String = "ABC"

if case "ABC" = anotherValue {
    print(anotherValue)
}   // ABC

enum MainDish {
    case pasta(taste: String)
    case pizza(dough: String, topping: String)
    case chicken(withSauce: Bool)
    case rice
}

var dishes: [MainDish] = []

var dinner: MainDish = .pasta(taste: "크림")  // 크림 파스타
dishes.append(dinner)

if case .pasta(let taste) = dinner {
    print("\(taste) 파스타")
}   // 크림 파스타

dinner = .pizza(dough: "치즈크러스트", topping: "불고기")    // 치즈크러스트 불고기 피자 만들기
dishes.append(dinner)

func whatIsThis(dish: MainDish) {
    guard case .pizza(let dough, let topping) = dinner else {
        print("It's not a Pizza")
        return
    }

    print("\(dough) \(topping) 피자")
}
whatIsThis(dish: dinner)        // 치즈크러스트 불고기 피자

dinner = .chicken(withSauce: true)  // 양념 통닭 만들기
dishes.append(dinner)

while case .chicken(let sauced) = dinner {
    print("\(sauced ? "양념" : "후라이드") 통닭")
    break
}   // 양념 통닭

dinner = .rice  // 밥
dishes.append(dinner)

if case .rice = dinner {
    print("오늘 저녁은 밥입니다.")
    // 오늘 저녁은 밥입니다.
}

for dish in dishes {
    switch dish {
    case .pasta(let taste): print(taste)
    case .pizza(let dough, let topping): print(dough, topping)
    case .chicken(let withSauce): print(withSauce ? "양념" : "후라이드")
    case .rice: print("Just 쌀")
    }
}
// 크림
// 치즈크러스트 불고기
// 양념
// Just 쌀
```

## 25.6 옵셔널 패턴

옵셔널 패턴은 옵셔널 또는 암시적 추출 옵셔널 열거형에 감싸져 있는 값을 매치시킬 때 사용한다. 옵셔널 패턴은 식별자 패턴 뒤에 물음표를 넣어 표기하며 열거형 케이스 패턴과 동일한 위치에 자리한다. 또 옵셔널 패턴은 옵셔널 값을 저장하는 배열의 for-in 구문을 통한 순환에서 nil이 아닌 값을 찾는 데도 유용하게 사용된다.

```swift
var optionalValue: Int? = 100

if case .some(let value) = optionalValue {
    print(value)
}   // 100

if case let value? = optionalValue {
    print(value)
    // 100
}

func isItHasValue(_ optionalValue: Int?) {
    guard case .some(let value) = optionalValue else {
        print("none")
        return
    }

    print(value)
}

isItHasValue(optionalValue) // 100

while case .some(let value) = optionalValue {
    print(value)
    optionalValue = nil
}   // 100

print(optionalValue)        // nil

let arrayOfOptionalInts: [Int?] = [nil, 2, 3, nil, 5]

for case let number? in arrayOfOptionalInts {
    print("Found a \(number)")
}
// Found a 2
// Found a 3
// Found a 5
```
